{{#extend "title"}}Dashboard{{/extend}}

<div class='page__dash'>
  <section class='section header pb-4'>
    <div class='container'>
      <h1 class='title is-primary'>Welcome back! Pick your adventure...</h1>
      <p>
        Task details will be presented to you once you select your task. Once selected, you will not
        be able to change it, and you will have a week to complete it.
      </p>
    </div>
  </section>

  <section class='section'>
    <div class='container'>
      <div class='columns projects'>
        {{#each projects}}
          {{>project}}
        {{/each}}
      </div>
    </div>
  </section>

  <div class="modal">
    <div class="modal-background"></div>
    <div class="modal-card">
      <header class="modal-card-head">
        <h1 class="modal-card-title">Heads up!</h1>
      </header>

      <section class="modal-card-body">
        <p class="modal-message">
          You're about to select <b class="modal-project-title"></b> as your project for the next week. Once you've selected a project for the week, <b class="has-text-danger">you cannot change your mind.</b>
        </p>

        <b>Are you sure you want to continue?</b>
      </section>

      <footer class="modal-card-foot">
        <form action="" method="POST" style="width: 100%">
          <button class="button is-danger modal-cancel" type="reset">
            <span>Pick again</span>
            <span class="icon">
              <ion-icon name='refresh-outline'></ion-icon>
            </span>
            <span>

          <button class="button is-primary is-pulled-right" type="submit">
            <span>Let's do this!</span>
            <span class="icon">
              <ion-icon name='arrow-forward-outline'></ion-icon>
            </span>
          </button>

          <input type="hidden" name="project_id" class="modal-project-id">
        </form>
      </footer>
    </div>
    <button class="modal-close modal-cancel is-large" aria-label="close"></button>
  </div>
</div>

<script nonce="{{nonce}}">
  const modal = document.querySelector(".modal")
  const modalProjectTitle = modal.querySelector('.modal-project-title')
  const modalProjectId = modal.querySelector('.modal-project-id')

  // Close modal on ESC keypress
  document.addEventListener('keydown', ({ key }) => {
    if (key === 'Escape') {
      modal.classList.remove('is-active')
    }
  })

  // Bind projects to modal + form
  document.querySelectorAll('.project')
    .forEach(node => {
      node.addEventListener('click', () => {
        modal.classList.add('is-active')

        modalProjectTitle.textContent = node.getAttribute('project-title')
        modalProjectId.value = node.getAttribute('project-id')
      })
    })

  // Close modal on background & cancel button click
  document.querySelectorAll('.modal-cancel, .modal-background')
    .forEach(node => {
      node.addEventListener('click', () => {
        modal.classList.remove('is-active')
      })
    })

</script>
